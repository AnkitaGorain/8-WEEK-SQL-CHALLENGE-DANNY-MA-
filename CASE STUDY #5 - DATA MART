-- 1. DATA CLEANING
DROP TABLE IF EXISTS data_mart.CLEAN_weekly_sales
 
SELECT PARSE(WEEK_DATE AS DATE USING 'UK') AS WEEK_DATE,
DATEPART(WEEK,PARSE(WEEK_DATE AS DATE USING 'UK')) AS WEEK_NUMBER,
DATEPART(MONTH,PARSE(WEEK_DATE AS DATE USING 'UK')) AS MONTH_NUMBER,
DATEPART(YEAR,PARSE(WEEK_DATE AS DATE USING 'UK')) AS CALENDAR_YEAR,
REGION,
PLATFORM,
CASE WHEN SEGMENT='NULL' THEN 'UNKNOWN' 
	 ELSE SEGMENT
END AS SEGMENT,
CASE WHEN SUBSTRING(SEGMENT,2,1)= '1' THEN 'YOUNG ADULTS'
     WHEN SUBSTRING(SEGMENT,2,1)= '2' THEN 'MIDDLE AGED'   --RIGHT FUNCTION WOULD BE APPROPRIATE HERE
	 WHEN SUBSTRING(SEGMENT,2,1)= '3' OR SUBSTRING(SEGMENT,2,1)='4' THEN 'RETIREES' --IN CAN BE USED (SUBSTRING(SEGMENT,2,1) IN ('3','4')
	 ELSE 'UNKNOWN'
END AS AGE_BAND,
CASE WHEN SUBSTRING(SEGMENT,1,1)= 'C' THEN 'COUPLES'
     WHEN SUBSTRING(SEGMENT,1,1)= 'F' THEN 'FAMILY'	
	 ELSE 'UNKNOWN'
END AS DEMOGRAPHIC,
CUSTOMER_TYPE,
TRANSACTIONS,
SALES,
SALES/TRANSACTIONS AS AVG_TRANSACTION
INTO DATA_MART.CLEAN_WEEKLY_SALES
FROM DATA_MART.WEEKLY_SALES

SELECT * FROM 
DATA_MART.CLEAN_WEEKLY_SALES
